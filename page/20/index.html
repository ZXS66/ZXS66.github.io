<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>æ—¶ä»£æ®‹å…š</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" href="/favicon.png">
<meta property="og:type" content="website">
<meta property="og:title" content="æ—¶ä»£æ®‹å…š">
<meta property="og:url" content="https://zxs66.github.io/page/20/">
<meta property="og:site_name" content="æ—¶ä»£æ®‹å…š">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="æ—¶ä»£æ®‹å…š">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="Angular">
<meta property="article:tag" content="NodeJS">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="ASP.NET">
<meta property="article:tag" content="Full Stack">
<meta name="twitter:card" content="summary">
<link rel="dns-prefetch" href="https://cdn.bootcdn.net/">
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://fonts.gstatic.com/">
<meta name="baidu-site-verification" content="1W34rVIdAO" />

<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous" integrity="sha256-eZrrJcwDc&#x2F;3uDhsdt61sL2oOBY362qM3lon1gyExkL0&#x3D; sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN sha512-SfTiTlX6kk+qitfevl&#x2F;7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+&#x2F;Sw&#x3D;&#x3D;">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" />


<link rel="stylesheet" href="/css/style.css">

<link rel="manifest" href="/manifest.json">
<script type="module" src="/pwabuilder-sw-register.js"></script>
<!-- ç™¾åº¦ç»Ÿè®¡ -->
<script>
var _hmt = _hmt || [];
(function () {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?de1c4b02a9f8a51a6001797e045d3af9";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>
</head><body>
<div id="container">
<div id="wrap">
<header id="header">
<div id="banner"></div>
<div id="header-outer" class="outer">
<div id="header-title" class="inner">
<h1 id="logo-wrap">
<a href="/" id="logo">æ—¶ä»£æ®‹å…š</a>
</h1>

<h2 id="subtitle-wrap">
<a href="/" id="subtitle">éšæ‰‹ç¬”è®°</a>
</h2>

</div>
<div id="header-inner" class="inner">
<nav id="main-nav">
<a id="main-nav-toggle" class="nav-icon"></a>

<a class="main-nav-link" href="/">é¦–é¡µ</a>

<a class="main-nav-link" href="/archives">å½’æ¡£</a>

<a class="main-nav-link" href="/app">è”ç³»æˆ‘</a>

</nav>
<div id="search-form-wrap">
<div class="search-form"><input type="search" name="wd" class="search-form-input" placeholder="Search" list="search-datalist" autocomplete="false"/></div>

<input type="hidden" id="search-index-file" value="/search.json" />
<div id="search-form-datalist"></div>

</div>
<nav id="sub-nav">

<a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
</nav>
</div>
</div>
</header>
<div class="outer">
<section id="main">


<article id="post-CDN-failover" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2020/07/23/CDN-failover/" class="article-date">
  <time datetime="2020-07-23T06:49:22.000Z" itemprop="datePublished">2020-07-23</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/23/CDN-failover/">CDN æ•…éšœè½¬ç§»</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>é¦–å…ˆè¯´ä¸€å¥ï¼Œè¿™ç¯‡æ–‡ç« æ ‡é¢˜å¯èƒ½ä¸å¤ªå‡†ç¡®ï¼Œå› ä¸ºæ¶‰åŠçš„æŠ€èƒ½ç‚¹å¯èƒ½æœ‰ç‚¹æ‚ï¼Œæ¯”è¾ƒè·³è·ƒï¼Œä½†æ˜¯éƒ½æ˜¯æˆ‘åœ¨åš CDN æ•…éšœè½¬ç§»æ—¶ç¢°åˆ°çš„ï¼Œæ‰€ä»¥å…¨éƒ½æ‰”åœ¨ä¸€ç¯‡æ–‡ç« é‡Œï¼Œä¸ä»‹æ„çš„è¯ï¼Œå°†å°±ç€å§ï¼Œæœ‰ä»€ä¹ˆä¸æ‡‚çš„ï¼Œè¯·ç‚¹å‡»æ–‡ç« ä¸­çš„å„ç§é“¾æ¥ ğŸ˜„</p>
<p>è¿™ç¯‡æ–‡ç« æ˜¯ç»§ä¸Šç¯‡æ–‡ç«  <a href="/2020/07/19/reliable-CDN/">å¯é  CDN</a> ä¹‹åçš„å¦ä¸€ç¯‡å…³äº CDN çš„æ€è€ƒåŠå®è·µã€‚</p>
<h2 id="SRI-æ£€æŸ¥"><a href="#SRI-æ£€æŸ¥" class="headerlink" title="SRI æ£€æŸ¥"></a>SRI æ£€æŸ¥</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener">SRI</a> æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œè®©æµè§ˆå™¨é€šè¿‡éªŒè¯å®ƒæ¥æ”¶åˆ°çš„èµ„æºï¼ˆæ¯”å¦‚ä» CDNï¼‰æ˜¯æœªç»è¿‡æ›´æ”¹çš„ã€‚ç®€å•ç†è§£å°±æ˜¯æµè§ˆå™¨æŠŠï¼ˆä» CDNï¼‰æ‹¿åˆ°çš„èµ„æºè¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œç„¶åæŠŠè¿™ä¸ªå“ˆå¸Œå€¼ä¸å¼€å‘è€…äº‹å…ˆè®¡ç®—å¥½çš„å“ˆå¸Œå€¼ï¼ˆintegrity) åŒ¹é…ã€‚ç›®å‰<a href="https://caniuse.com/#feat=subresource-integrity" target="_blank" rel="noopener">å¤§å¤šæ•°æµè§ˆå™¨éƒ½æ”¯æŒ SRI æ£€æŸ¥</a>(emmmï¼Œé™¤äº† IE)ã€‚ </p>
<p>å®é™…ä½¿ç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯æŒ‡å®š <code>script</code> æˆ– <code>link</code> æ ‡ç­¾çš„ <code>integrity</code> å±æ€§ï¼Œå€¼ä¸ºäº‹å…ˆè®¡ç®—çš„è¯¥é™æ€èµ„æºçš„å“ˆå¸Œå€¼ï¼ˆsha256ï¼Œsha384ï¼Œsha512ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#Using_Subresource_Integrity" target="_blank" rel="noopener"><fa-link/></a>ã€‚MDN æ¨èäº†ä¸€ä¸ª <a href="https://www.srihash.org/" target="_blank" rel="noopener">SRI Hash Generator</a> <em>ï¼ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œåªèƒ½ç”Ÿæˆ script ä¾¿ç­¾ï¼Œä¸èƒ½æ ¹æ® css æ–‡ä»¶æˆ link æ ‡ç­¾ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒæ•´ï¼‰</em></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬éœ€è¦ SRI æ£€æŸ¥çš„é™æ€èµ„æºéƒ½åœ¨ CDN ä¸Šï¼Œæ‰€ä»¥éƒ½æ˜¯éœ€è¦å¼€å¯ CORSã€‚å¥½åœ¨ CDN é»˜è®¤éƒ½å¼€å¯äº†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯æµè§ˆå™¨ç«¯æ‰‹åŠ¨æ·»åŠ ä¸Š <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes" target="_blank" rel="noopener">crossorigin å±æ€§</a>ï¼Œä¸ç„¶å¯èƒ½ä¼šå‡ºé”™ :(</p>
<h2 id="æ ‡è®°-script-æ ‡ç­¾ä¸º-async-æˆ–-defer"><a href="#æ ‡è®°-script-æ ‡ç­¾ä¸º-async-æˆ–-defer" class="headerlink" title="æ ‡è®° script æ ‡ç­¾ä¸º async æˆ– defer"></a>æ ‡è®° script æ ‡ç­¾ä¸º async æˆ– defer</h2><p>ä¸‹é¢æ˜¯ <code>script</code> æ ‡ç­¾çš„å±æ€§ï¼ˆ<code>async</code>ã€<code>defer</code>ã€<code>module</code>ã€<code>nomodule</code>ç­‰ï¼‰å¸¸ç”¨åœºæ™¯ <a href="https://gist.github.com/jakub-g/385ee6b41085303a53ad92c7c8afd7a6" target="_blank" rel="noopener"><fa-link/></a>ï¼š</p>
<table>
<thead>
<tr>
<th><code>script</code>æ ‡ç­¾ç±»å‹</th>
<th>å¸¸è§ä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>script src</td>
<td>a legacy library that is needed by subsequent inline scripts</td>
</tr>
<tr>
<td>script src defer</td>
<td>deferred execution, maintaining order; e.g. a lib that is needed by other defer scripts; progressive enhancement code</td>
</tr>
<tr>
<td>script src async</td>
<td>deferred execution, without order (independent scripts); e.g. self-instantiating analytics lib</td>
</tr>
<tr>
<td>script src async defer</td>
<td>like above, but with IE9 support</td>
</tr>
<tr>
<td>script inline</td>
<td>1) small piece of code that must be executed immediately, before some subsequent code (inlined polyfills, timers, server-generated configuration), or to register certain event listeners as soon as possible; 2) non-cacheable (generated, often changing etc.) code; 3) experience critical code that is small and the round-trip latency to download it separately would be too much</td>
</tr>
<tr>
<td>script src module</td>
<td>library/app, for modern browsers only</td>
</tr>
<tr>
<td>script src module async</td>
<td>progressive enhancement code, for modern browsers only</td>
</tr>
<tr>
<td>script inline module</td>
<td>small piece of and/or non-cacheable code, for modern browsers only; perhaps inline config that is necessary for another non-async module declared after it</td>
</tr>
<tr>
<td>script inline module async</td>
<td>small piece of and/or non-cacheable progressive enhancement code (independent script), for modern browsers only; it may <code>import</code>s a well-cacheable library</td>
</tr>
<tr>
<td>script nomodule â€¦</td>
<td>a fallback script for legacy browsers, when shipping ES modules to modern browsers</td>
</tr>
</tbody></table>
<p>ç®€ç•¥ç‰ˆçš„è¯·çœ‹å›¾ï¼š</p>
<p><img src="/images/cdn-failover/a%20comparison%20of%20various%20ways%20the%20script%20tags%20in%20HTML.png" alt="A comparison of various ways the script tags in HTML"></p>
<p>æ€»ç»“ï¼š<strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>async</code> ç”¨äºåŠ è½½åŸºç¡€ç±»åº“ï¼ˆåŠ è½½å®Œç«‹å³æ‰§è¡Œï¼Œæ— ä¾èµ–é¡¹ï¼‰ï¼Œ<code>defer</code> ç”¨äºåŠ è½½ä¸€äº› addonï¼ˆå¾…åŸºç¡€ç±»åº“åŠ è½½å®Œåï¼Œ<code>DOMContentLoaded</code> äº‹ä»¶å‰ï¼Œä¾æ¬¡æ‰§è¡Œï¼‰</strong>ã€‚</p>
<h2 id="è°ƒæ•´-Hexo-æ¨¡æ¿ç”Ÿæˆè„šæœ¬"><a href="#è°ƒæ•´-Hexo-æ¨¡æ¿ç”Ÿæˆè„šæœ¬" class="headerlink" title="è°ƒæ•´ Hexo æ¨¡æ¿ç”Ÿæˆè„šæœ¬"></a>è°ƒæ•´ Hexo æ¨¡æ¿ç”Ÿæˆè„šæœ¬</h2><h5 id="å¢åŠ -CDN-é…ç½®é¡¹"><a href="#å¢åŠ -CDN-é…ç½®é¡¹" class="headerlink" title="å¢åŠ  CDN é…ç½®é¡¹"></a>å¢åŠ  CDN é…ç½®é¡¹</h5><p>ğŸ‘‡ _config.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cdn:</span> <span class="string">https://cdn.bootcdn.net/ajax/libs/</span></span><br></pre></td></tr></table></figure>

<h5 id="ä½¿ç”¨-Hexo-é»˜è®¤çš„-helper-æ–¹æ³•-js-css-ç”Ÿæˆ-script-link-æ ‡ç­¾ã€‚"><a href="#ä½¿ç”¨-Hexo-é»˜è®¤çš„-helper-æ–¹æ³•-js-css-ç”Ÿæˆ-script-link-æ ‡ç­¾ã€‚" class="headerlink" title="ä½¿ç”¨ Hexo é»˜è®¤çš„ helper æ–¹æ³• js/css ç”Ÿæˆ script/link æ ‡ç­¾ã€‚"></a>ä½¿ç”¨ <a href="https://hexo.io/docs/helpers.html" target="_blank" rel="noopener">Hexo é»˜è®¤çš„ helper æ–¹æ³•</a> js/css ç”Ÿæˆ script/link æ ‡ç­¾ã€‚</h5><p>ğŸ‘‡ after-footer.ejs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- js(&#123;src:config.cdn+&#39;jquery&#x2F;2.0.3&#x2F;jquery.min&#39;,integrity:&#39;sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU&#x3D; sha384-ECTndYny330R2jlSXBiZkdXzAVi0Z&#x2F;iDXJTwV6cp39HECmalqg6+b2sFZFf&#x2F;Y2m6 sha512-epzJ9ms+0Pq+zFMrG1lXVNvjEXgtfKx9iuEWqz3hmbaU2m&#x2F;Dp1pcmpYzuSdDLqX6PMIjzMOyGFwMc+SkgFhMFg&#x3D;&#x3D;&#39;,crossorigin:&#39;anonymous&#39;&#125;) %&gt;</span><br><span class="line">&lt;% if (theme.fancybox)&#123; %&gt;</span><br><span class="line">&lt;%- css(&#123;href:config.cdn+&#39;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.min&#39;,integrity:&#39;sha384-RMsmRsuFJAxdvCCX2XHjTlWajoB7207PpLqA4HMVuie0TAWK0x+7ubbuDa58Tcij&#39;,crossorigin:&#39;anonymous&#39;&#125;) %&gt;</span><br><span class="line">&lt;%- js(&#123;src:config.cdn+&#39;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.pack&#39;,integrity:&#39;sha384-A&#x2F;Tc8RFHsjkPvgL0yZebgTxxmCGCSaTpGkyQLeFFFJQIAzSozLwNGX9AOCIpxoXC&#39;,crossorigin:&#39;anonymous&#39;,defer:true&#125;) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;%- js(&#123;src:&#39;js&#x2F;script&#39;,defer:true&#125;) %&gt;</span><br></pre></td></tr></table></figure>

<h5 id="ç¼–å†™è‡ªå®šä¹‰-Hexo-Helper-æ–¹æ³•-Optional"><a href="#ç¼–å†™è‡ªå®šä¹‰-Hexo-Helper-æ–¹æ³•-Optional" class="headerlink" title="ç¼–å†™è‡ªå®šä¹‰ Hexo Helper æ–¹æ³• (Optional)"></a>ç¼–å†™è‡ªå®šä¹‰ Hexo Helper æ–¹æ³• (<em>Optional</em>)</h5><p>Hexo é»˜è®¤çš„ helper æ–¹æ³• <code>js</code> å’Œ <code>css</code> è¶³å¤Ÿä½¿ç”¨ï¼Œä½†æ˜¯è¿˜æœ‰ç²¾ç®€çš„ç©ºé—´ã€‚æ¯”å¦‚æ¯ä¸ªæ–¹æ³•çš„å‚æ•°å‡åŒ…å« <code>config.cdn</code> å’Œ <code>crossorigin:&#39;anonymous&#39;</code>ï¼Œä¸€ä¸ªç¨‹åºå‘˜çš„åŸºæœ¬ç´ å…»å°±æ˜¯ DRY (Donâ€™t Repeat Yourself)ã€‚ä»¥ä¸‹å°±æ˜¯å…¶ä¸­ä¸€ç§ä¼˜åŒ–æªæ–½ ï¼ˆ<a href="https://hexo.io/api/helper.html" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a>ï¼‰ï¼š</p>
<p>åœ¨ <code>theme/your-theme/scripts</code> ä¸‹æ–°å»º <code>js_cdn.js</code> å’Œ <code>css_cdn.js</code> æ–‡ä»¶ã€‚å…¶ä¸­å‰è€…å†…å®¹å¦‚ä¸‹ï¼ˆåè€…å†…å®¹æå…¶ç›¸ä¼¼ï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.helper.register(<span class="string">"js_cdn"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> js = hexo.extend.helper.get(<span class="string">"js"</span>).bind(hexo);</span><br><span class="line">  <span class="keyword">const</span> integrityProp = <span class="string">"integrity"</span>;</span><br><span class="line">  <span class="keyword">const</span> placeholder = <span class="string">" "</span> + integrityProp;</span><br><span class="line">  <span class="keyword">const</span> crossoriginAttr = <span class="string">' crossorigin="anonymous"'</span>;</span><br><span class="line">  <span class="keyword">let</span> markup = js(item);</span><br><span class="line">  <span class="keyword">if</span> (item.hasOwnProperty(integrityProp)) &#123;</span><br><span class="line">    <span class="comment">// default `js` helper function doesn't include crossorigin="anonymous" in the generated script markup</span></span><br><span class="line">    <span class="keyword">const</span> idx = markup.indexOf(placeholder);</span><br><span class="line">    markup = [markup.substring(<span class="number">0</span>, idx), crossoriginAttr, markup.substring(idx)].join(<span class="string">""</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> markup;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°æ¨¡æ¿ç”Ÿæˆè„šæœ¬ <code>after-footer.ejs</code> (åˆ é™¤ <code>,crossorigin:&#39;anonymous&#39;</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- js_cdn(&#123;src:config.cdn+&#39;jquery&#x2F;2.0.3&#x2F;jquery.min&#39;,integrity:&#39;sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU&#x3D; sha384-ECTndYny330R2jlSXBiZkdXzAVi0Z&#x2F;iDXJTwV6cp39HECmalqg6+b2sFZFf&#x2F;Y2m6 sha512-epzJ9ms+0Pq+zFMrG1lXVNvjEXgtfKx9iuEWqz3hmbaU2m&#x2F;Dp1pcmpYzuSdDLqX6PMIjzMOyGFwMc+SkgFhMFg&#x3D;&#x3D;&#39;&#125;) %&gt;</span><br><span class="line">&lt;% if (theme.fancybox)&#123; %&gt;</span><br><span class="line">&lt;%- css_cdn(&#123;href:config.cdn+&#39;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.min&#39;,integrity:&#39;sha384-RMsmRsuFJAxdvCCX2XHjTlWajoB7207PpLqA4HMVuie0TAWK0x+7ubbuDa58Tcij&#39;&#125;) %&gt;</span><br><span class="line">&lt;%- js_cdn(&#123;src:config.cdn+&#39;fancybox&#x2F;2.1.5&#x2F;jquery.fancybox.pack&#39;,integrity:&#39;sha384-A&#x2F;Tc8RFHsjkPvgL0yZebgTxxmCGCSaTpGkyQLeFFFJQIAzSozLwNGX9AOCIpxoXC&#39;,defer:true&#125;) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;%- js_cdn(&#123;src:&#39;js&#x2F;script&#39;,defer:true&#125;) %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="CDN-æ•…éšœè½¬ç§»"><a href="#CDN-æ•…éšœè½¬ç§»" class="headerlink" title="CDN æ•…éšœè½¬ç§»"></a>CDN æ•…éšœè½¬ç§»</h2><p>è¿›å…¥æœ¬æ–‡æ­£æ–‡äº†ï¼</p>
<p>è€ƒè™‘åˆ° CDN ä¹Ÿæœ‰ä¼šæœ‰æ‰“ç›¹çš„æ—¶å€™ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„å®è·µå°±æ˜¯æ—¶åˆ»åšå¥½ Plan Bã€‚æˆ‘çš„æ–¹æ³•æ˜¯ï¼Œåœ¨é¡µé¢çš„è‡ªå®šä¹‰è„šæœ¬ä¸­æ£€æŸ¥è„šæœ¬åŠ è½½æƒ…å†µå¹¶åœ¨æ‰§è¡Œå°è¯•åŠ è½½å€™é€‰èµ„æºã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼ˆ<code>js/script.js</code>ï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dependencies = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">export</span>: <span class="built_in">window</span>.jQuery,</span><br><span class="line">      failover: <span class="string">"https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"</span>,</span><br><span class="line">      <span class="comment">// failover: "https://code.jquery.com/jquery-2.0.3.min.js",</span></span><br><span class="line">      integrity: <span class="string">"sha256-sTy1mJ4I/LAjFCCdEB4RAvPSmRCb3CU7YqodohyeOLo="</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">export</span>: (<span class="built_in">window</span>.jQuery || &#123;&#125;).fancybox,</span><br><span class="line">      failover:</span><br><span class="line">        <span class="string">"https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"</span>,</span><br><span class="line">      integrity:</span><br><span class="line">        <span class="string">"sha384-A/Tc8RFHsjkPvgL0yZebgTxxmCGCSaTpGkyQLeFFFJQIAzSozLwNGX9AOCIpxoXC"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// failover to load alternative files when CDN libraries failed.</span></span><br><span class="line">  <span class="keyword">var</span> nonLoadedDependencies = dependencies.filter(<span class="function"><span class="keyword">function</span>(<span class="params">dep</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !dep.export;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">/** lazy load js files */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadDependency</span>(<span class="params">dep</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">      script.src = dep.failover;</span><br><span class="line">      <span class="keyword">if</span> (dep.integrity &amp;&amp; dep.integrity.length) &#123;</span><br><span class="line">        script.integrity = dep.integrity;</span><br><span class="line">        script.crossOrigin = <span class="string">"anonymous"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// // https://www.html5rocks.com/en/tutorials/speed/script-loading/#toc-dom-rescue</span></span><br><span class="line">      script.async = <span class="literal">false</span>;</span><br><span class="line">      script.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        resolve(dep.failover + <span class="string">" is loaded"</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      script.addEventListener(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        reject(dep.failover + <span class="string">" can't be loaded!"</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  (nonLoadedDependencies.length</span><br><span class="line">    ? <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all(nonLoadedDependencies.map(loadDependency)).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          resolve(<span class="string">"All dependencies are loaded!"</span>);</span><br><span class="line">        &#125;, reject);</span><br><span class="line">      &#125;)</span><br><span class="line">    : <span class="built_in">Promise</span>.resolve(<span class="string">"All dependencies are loaded!"</span>)</span><br><span class="line">  ).then(myBiz);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** business logic, will be executed when all dependencies loaded */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">myBiz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/// your business code comes here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æœ‰ä¸€è¡Œè¯­å¥éœ€è¦å•ç‹¬æ‹å‡ºæ¥è®²ä¸€ä¸‹çš„ï¼Œå°±æ˜¯ä¸Šé¢è„šæœ¬çš„ç¬¬ 31 è¡Œï¼Œ<code>script.async = false;</code></p>
<p>å¦‚æœæ‚¨çš„ <code>dependencies</code> éƒ½æ²¡æœ‰ä¾èµ–é¡¹ï¼Œæœ‰æ²¡æœ‰è¿™æ¡è¯­å¥å…³ç³»ä¸å¤§ï¼Œç›¸åè¿˜èƒ½æé«˜åŠ è½½æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œç°å®æƒ…å†µæ˜¯å¾ˆå¤šè„šæœ¬éƒ½æ˜¯æœ‰ä¾èµ–é¡¹çš„ï¼Œä¸Šé¢è´´çš„ä»£ç å°±æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚<code>jquery.fancybox.pack.js</code> æ–‡ä»¶ä¾èµ–äº <code>jquery.min.js</code> æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰è¿™è¡Œè¯­å¥ï¼Œé»˜è®¤è¿™äº› <code>script</code> ä¼šæŒ‰ <code>async</code> çš„æ–¹å¼å»æ‰§è¡Œï¼ˆè„šæœ¬ä¸‹è½½æˆåŠŸç«‹å³æ‰§è¡Œï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯èƒ½ä¼šå‡ºç°åé¢çš„è„šæœ¬å…ˆè¢«æ‰§è¡Œçš„æƒ…å†µã€‚ä½†æ˜¯åé¢çš„è„šæœ¬ä¾èµ–äºå‰é¢çš„è„šæœ¬ï¼Œç«‹å³æ‰§è¡Œä¼šæŠ¥é”™ã€‚</p>
<p><img src="/images/cdn-failover/dependent%20script%20execution%20error.png" alt=""></p>
<p>å— <a href="https://www.html5rocks.com/en/tutorials/speed/script-loading/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> å¯å‘ï¼ŒåŠ ä¸Šä¸Šé¢è¯´çš„è¿™æ¡è¯­å¥ï¼Œå°±å¯ä»¥ç¡®ä¿ async çš„è„šæœ¬çš„æ‰§è¡Œé¡ºåºäº†ã€‚</p>
<p>è°ƒæ•´å®Œä¹‹åçš„è„šæœ¬ä¸‹è½½æ—¶é—´ä¸å˜ï¼Œä½†æ˜¯ä¸æŠ¥é”™äº†ï¼Œå› ä¸ºæ‰§è¡Œé¡ºåºå¯¹ä¸Šäº†ã€‚</p>
<p><img src="/images/cdn-failover/async%20script%20execution%20order.png" alt=""></p>
<p>å½“ç„¶ï¼Œè¿™ä¸ªè„šæœ¬è¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ï¼ˆæ¯”å¦‚ï¼Œ<code>Promise</code> åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨å…¼å®¹é—®é¢˜ï¼‰ï¼Œè¿™é‡Œæš‚æ—¶å°±ä¸æµªè´¹ä½“åŠ›äº†ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>æ—¢ç„¶åŠ¨æ€æ·»åŠ çš„ <code>async</code> è„šæœ¬æ‰§è¡Œé¡ºåºä¸ç¡®å®šï¼Œé‚£ <code>defer</code> è„šæœ¬å¦‚ä½•å‘¢ï¼Ÿï¼Ÿ</p>
<h2 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h2><ul>
<li><a href="https://gist.github.com/jakub-g/385ee6b41085303a53ad92c7c8afd7a6" target="_blank" rel="noopener">&lt;script&gt; async, defer, async defer, module, nomodule, src, inline - the cheat sheet</a></li>
<li><a href="https://javascript.info/script-async-defer" target="_blank" rel="noopener">Scripts: async, defer</a></li>
</ul>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2020/07/23/CDN-failover/" data-id="clbs21ii6000go48c5sn98aqu" data-title="CDN æ•…éšœè½¬ç§»" class="article-share-link">åˆ†äº«</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/async/" rel="tag">async</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cdn/" rel="tag">cdn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/defer/" rel="tag">defer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/execution-order/" rel="tag">execution order</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/failover/" rel="tag">failover</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

</footer>
</div>

</article>



<article id="post-reliable-CDN" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2020/07/19/reliable-CDN/" class="article-date">
  <time datetime="2020-07-19T07:40:45.000Z" itemprop="datePublished">2020-07-19</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/19/reliable-CDN/">å¯é  CDN</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>å‰å‡ å¤©ï¼ŒæŠŠåšå®¢çš„ <a href="https://fontawesome.com/" target="_blank" rel="noopener">font-awesome</a> å¼•ç”¨ä»åšå®¢ç«™ç‚¹æœ¬èº«åˆ‡æ¢åˆ° CDNã€‚å›¾çœäº‹ï¼Œå°±ç”¨äº†ä»¥å‰å›½å†…å¤–é€šç”¨çš„ <a href="https://www.cloudflare.com/zh-cn/network/china/" target="_blank" rel="noopener">cloudflare</a>ï¼Œå› ä¸ºä¹‹å‰ä¸ç®¡æ˜¯åœ¨å…¬å¸ï¼ˆå¤–ç½‘ï¼‰ï¼Œè¿˜æ˜¯åœ¨å®¶é‡Œï¼ˆå›½å†…ï¼‰ï¼Œè®¿é—®éƒ½æŒºå¿«çš„ã€‚ç„¶åï¼Œå°±å‡ºäº‹äº†ã€‚ã€‚ã€‚</p>
<p>ä»Šå¤©åœ¨å®¶ï¼Œé—²æ¥æ²¡äº‹ï¼Œæ‰“å¼€è‡ªå·±çš„åšå®¢ï¼Œå‘ç° font-awesome åŠ è½½ä¸äº†ã€‚èµ·åˆï¼Œæˆ‘ä»¥ä¸ºæ˜¯æµè§ˆå™¨é—®é¢˜ï¼Œå› ä¸ºæˆ‘ç”¨ Firefox æœ‰æ—¶å€™èƒ½æ­£å¸¸æ¸²æŸ“ icon fontï¼Œè¿‡ä¸€ä¼šå„¿åˆ·æ–°ä¸€ä¸‹åˆä¸èƒ½äº†ï¼Œä½†æ˜¯æˆ‘ç”¨ Chrome ä¸€ç›´éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<p>å»ç½‘ä¸Šæœç´¢ä¸€åœˆï¼Œå‘ç° MDN è¯´ï¼š</p>
<blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener"><i class="fa fa-link" aria-hidden="true"></i></a> Web Fonts (for cross-domain font usage in @font-face within CSS), so that servers can deploy TrueType fonts that can only be cross-site loaded and used by web sites that are permitted to do so. </p>
</blockquote>
<blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener"><i class="fa fa-link" aria-hidden="true"></i></a> Fonts applied with @font-face. Some browsers allow cross-origin fonts, others require same-origin. </p>
</blockquote>
<p>å‘ç”Ÿè·¨åŸŸäº†ï¼ŸåºŸè¯ï¼Œç”¨ CDN è‚¯å®šè¦è·¨åŸŸå•Šã€‚ä½†è¿™äº›åº”è¯¥éƒ½æ˜¯æ­£å¸¸æ“ä½œï¼ŒChrome éƒ½è¡Œã€‚emmmï¼ŒFirefox ä½ åœ¨ä½œå¦–å—ã€‚MDN è¯´çš„ othersï¼Œè¯¥ä¸ä¼šè¯´çš„å°±æ˜¯å®ƒè‡ªå·±å§ã€‚ã€‚ã€‚</p>
<p>æŸ¥è¯ä¸€ä¸‹ <a href="https://caniuse.com/#feat=fontface" target="_blank" rel="noopener">Can I use</a>ï¼š</p>
<p><img src="/images/reliable-cdn/caniuse%20font%20face%20web%20fonts.jpg" alt=""></p>
<p>åªè¦æœåŠ¡å™¨æ”¯æŒ CORS æµè§ˆå™¨å°±æ²¡é—®é¢˜ï¼<a href="http://cssbakery.com/2010/07/fixing-firefox-font-face-cross-domain_25.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> é‡åˆ°çš„é—®é¢˜ä¹Ÿæ˜¯è¿™æ ·ã€‚</p>
<p>ä¸ä¼šå§ï¼ŒCDN ä¸æ”¯æŒ CORS é‚£ CDN è¦æ€ä¹ˆç”¨ï¼Œcloudflare è‚¯å®šæ˜¯æ”¯æŒ CORS çš„ï¼</p>
<p>å†å›å¤´å¯¹æ¯”ä¸€ä¸‹ï¼Œæˆ‘å‘ç°æ˜¯ Firefox è¯·æ±‚å­—ä½“æ–‡ä»¶å‡ºé”™æ—¶ï¼Œå‘é€çš„è¯·æ±‚ï¼Œæ˜¯ä¸å¸¦ HTTP ç‰ˆæœ¬å·çš„ã€‚</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid.jpg" alt="firefox è¯·æ±‚å­—ä½“æ–‡ä»¶ä¸å¸¦ç‰ˆæœ¬å·"></p>
<p>è€Œæ­£å¸¸è¯·æ±‚æ˜¯æŒ‡å®šäº† HTTP ç‰ˆæœ¬å·çš„ï¼š</p>
<p><img src="/images/reliable-cdn/firefox%20working.jpg" alt="firefox æ­£å¸¸è¯·æ±‚å­—ä½“"></p>
<p>ä½†æ˜¯å¶ç„¶åˆæœ‰ä¸€æ¬¡å¸¦äº†ç‰ˆæœ¬å·ä¾ç„¶æ— æ³•è¯·æ±‚èµ„æº</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid%204.jpg" alt="firefox è¯·æ±‚å­—ä½“æ–‡ä»¶ä¸å¸¦ç‰ˆæœ¬å·"></p>
<p>ä»€ä¹ˆé¬¼ï¼Œä½ è€æˆ‘ï¼Ÿ <img src="/images/reliable-cdn/questions.png" alt="ï¼Ÿï¼Ÿï¼Ÿ"> </p>
<p>è«éï¼ŒçœŸçš„æ˜¯ CDN é—®é¢˜ï¼Ÿæˆ‘æŸ¥æŸ¥â€¦</p>
<p>å¥½å®¶ä¼™ï¼Œè¿˜çœŸæœ‰é—®é¢˜ï¼<a href="https://segmentfault.com/a/1190000023290310" target="_blank" rel="noopener">Cloudflare DNS æœåŠ¡ä¸­æ–­ï¼Œå¤§é‡ç½‘ç«™å’ŒæœåŠ¡æ— æ³•è®¿é—®</a> </p>
<p>è™½ç„¶æ–‡ä¸­å¹¶æœªæåŠå›½å†…æ˜¯å¦å—æ³¢åŠï¼Œä½†ä¸ºä»€ä¹ˆæˆ‘å—å½±å“äº†ï¼Ÿæˆ‘å» <a href="https://www.cloudflarestatus.com/" target="_blank" rel="noopener">å®˜ç½‘</a> çœ‹çœ‹ã€‚å®˜ç½‘è¯´äº†</p>
<blockquote>
<p>All Systems Operational</p>
</blockquote>
<p>æ‰€æœ‰èŠ‚ç‚¹å‡æ­£å¸¸ï¼Ÿä½ ç¡®å®šï¼Ÿç„¶åï¼Œæˆ‘å‘ç°ï¼Œ7æœˆ17å·ï¼Œä¹Ÿå°±æ˜¯å‰å¤©æœ‰ä¸€ä¸ª incident</p>
<blockquote>
<h2 id="Cloudflare-Network-and-Resolver-Issues"><a href="#Cloudflare-Network-and-Resolver-Issues" class="headerlink" title="Cloudflare Network and Resolver Issues"></a>Cloudflare Network and Resolver Issues</h2><p>Resolved - This incident has been resolved.<br>Jul 17, 22:57 UTC<br>Monitoring - A fix has been implemented and we are monitoring the results.<br>Jul 17, 22:34 UTC<br>Update - This afternoon we saw an outage across some parts of our network. It was not as a result of an attack. It appears a router on our global backbone announced bad routes and caused some portions of the network to not be available. We believe we have addressed the root cause and are monitoring systems for stability now.<br>Jul 17, 22:09 UTC</p>
</blockquote>
<p>å˜¶<del>~</del> æœ‰ç‚¹ä¸é è°±çš„æ„Ÿè§‰ã€‚æ²¡äººæ”»å‡»æ‚¨ï¼Œåå°è·¯ç”±å‡ºé—®é¢˜äº†ï¼Ÿ</p>
<p>ç¨ç­‰ï¼Œæˆ‘ä¹‹å‰å¥½åƒçœ‹è§ï¼Œcloudflare å›½å†…æ˜¯å’Œç™¾åº¦äº‘åˆä½œçš„ï¼Ÿå˜¶<del>~</del> ï¼ˆä¸å¹ä¸é»‘ï¼Œåªæ˜¯ä¸ªäººä¸å–œæ¬¢å¤ªå•†ä¸šåŒ–çš„ä¸œè¥¿ï¼‰</p>
<p>æ‹œæ‹œå’¯ï¼Œcloudflareï¼ä¸‹è½½ä¸€ä¸ª js å’Œ css æ–‡ä»¶éƒ½è¿™ä¹ˆæ…¢ï¼Œè¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨è‡ªå·±ç«™ç‚¹èµ„æº ğŸ¤¦â€</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid%202.jpg" alt="firefox è¯·æ±‚ css æ–‡ä»¶"><br><img src="/images/reliable-cdn/firefox%20cert%20invalid%203.jpg" alt="firefox è¯·æ±‚ js æ–‡ä»¶"></p>
<p>æ—¢ç„¶ä¸ç”¨ cloudflareï¼Œé‚£æ¢è°å‘¢ï¼Ÿç®€å•æœç´¢äº†ä¸€ä¸‹ï¼Œç›®å‰çœ‹èµ·æ¥ï¼Œbootcdn è¿˜ä¸é”™ï¼Œè¡Œï¼Œå®‰æ’ï¼ï¼</p>
<p>åˆ·åˆ·åˆ·ï¼Œæå®šï¼</p>
<p>firefox æ‰“å¼€ï¼Œæ­£å¸¸ï¼</p>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2020/07/19/reliable-CDN/" data-id="clbs21ik4008qo48c8kg77ino" data-title="å¯é  CDN" class="article-share-link">åˆ†äº«</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/baidu/" rel="tag">baidu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cdn/" rel="tag">cdn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cloudflare/" rel="tag">cloudflare</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iconfont/" rel="tag">iconfont</a></li></ul>

</footer>
</div>

</article>



<article id="post-get-started-with-Flutter" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2020/07/18/get-started-with-Flutter/" class="article-date">
  <time datetime="2020-07-18T07:10:21.000Z" itemprop="datePublished">2020-07-18</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/18/get-started-with-Flutter/">Flutter å…¥é—¨</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<h2 id="ä¸ºä»€ä¹ˆè¦å­¦-Flutterï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å­¦-Flutterï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å­¦ Flutterï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å­¦ Flutterï¼Ÿ</h2><ul>
<li>æå‡æŠ€èƒ½ã€‚ç§»åŠ¨ç«¯ skillset âˆš ï¼Œå…¨æ ˆå¼€å‘ âˆš</li>
<li>Flutter æ˜¯è¶‹åŠ¿ã€‚â€œ<em>Google å‡ºå“ï¼Œå¿…æ˜¯ç²¾å“ï¼</em>â€</li>
<li>React Native ä¸æ„Ÿå†’</li>
</ul>
<h2 id="ç½‘ç«™"><a href="#ç½‘ç«™" class="headerlink" title="ç½‘ç«™"></a>ç½‘ç«™</h2><ul>
<li><a href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a> <em>ã€Flutter å®˜ç½‘ã€‘</em></li>
<li><a href="https://flutter.cn/" target="_blank" rel="noopener">Flutter ä¸­æ–‡ç¤¾åŒº</a> <em>ã€Flutter å®˜ç½‘ï¼ˆä¸­æ–‡ï¼‰ã€‘</em></li>
<li><a href="https://dart.cn/guides/language/language-tour" target="_blank" rel="noopener">Dart å¼€å‘è¯­è¨€æ¦‚è§ˆ</a> <em>ã€1å°æ—¶å…¥é—¨ Dartã€‘</em></li>
<li><a href="https://codelabs.flutter-io.cn/" target="_blank" rel="noopener">Flutter Codelabs</a> <em>ã€æ›´å¤šå…¥é—¨æ¡ˆä¾‹ã€‘</em></li>
<li><a href="https://www.yuque.com/xytech/flutter/aqsvov" target="_blank" rel="noopener">é‡ç£…|åº–ä¸è§£ç‰›ä¹‹â€”â€”Flutter for Web Â· è¯­é›€</a> <em>ã€å’¸é±¼å‡ºå“ã€‘</em></li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å› ä¸ºæœ¬æ¥å°±æ‰“ç®—å°è¯• Flutter for Webï¼Œè€Œæ­¤åŠŸèƒ½ç›®å‰è¿˜å¤„äº beta åˆ†æ”¯ï¼Œæ‰€ä»¥ä¸‹è½½ <code>xxxx-stable.zip</code> å®‰è£…åŒ…åŸºæœ¬æ²¡ç”¨ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦åˆ‡æ¢åˆ†æ”¯ï¼Œé‡æ–°æ›´æ–°ã€‚æ‰€ä»¥ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„å®‰è£…æ–¹æ³•ï¼š</p>
<h5 id="1-ä»-GitHub-ä¸Šä¸‹è½½æœ€æ–°-beta-åˆ†æ”¯-git-clone"><a href="#1-ä»-GitHub-ä¸Šä¸‹è½½æœ€æ–°-beta-åˆ†æ”¯-git-clone" class="headerlink" title="1. ä» GitHub ä¸Šä¸‹è½½æœ€æ–° beta åˆ†æ”¯ (git clone)"></a>1. ä» GitHub ä¸Šä¸‹è½½æœ€æ–° beta åˆ†æ”¯ (git clone)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/flutter/flutter.git -b beta</span><br></pre></td></tr></table></figure>

<h5 id="2-æ›´æ–°ç¯å¢ƒå˜é‡"><a href="#2-æ›´æ–°ç¯å¢ƒå˜é‡" class="headerlink" title="2. æ›´æ–°ç¯å¢ƒå˜é‡ "></a>2. æ›´æ–°ç¯å¢ƒå˜é‡ <a href="https://flutter.cn/docs/get-started/install/windows" target="_blank" rel="noopener"><fa-link/></a></h5><p>å°† <code>flutter\bin</code> æ·»åŠ è‡³ç¯å¢ƒå˜é‡ <code>PATH</code>ã€‚Linux å’Œ Mac ç”¨æˆ·å‘½ä»¤è¡Œæå®šï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH="$PWD/flutter/bin:$PATH"</span><br></pre></td></tr></table></figure>

<p>Windows ç”¨æˆ·å¯ä»¥é€‰æ‹©é¼ æ ‡ç‚¹ç‚¹ï¼Œæ›´æ”¹ç¯å¢ƒå˜é‡ ï¼ˆæˆ‘çš„ç”µè„‘-&gt;å±æ€§-&gt;é«˜çº§ç³»ç»Ÿè®¾ç½®-&gt;ç¯å¢ƒå˜é‡-&gt;ç”¨æˆ·å˜é‡ï¼‰</p>
<h5 id="3-é…ç½®-flutter-ä½¿ç”¨é•œåƒç«™ç‚¹"><a href="#3-é…ç½®-flutter-ä½¿ç”¨é•œåƒç«™ç‚¹" class="headerlink" title="3. é…ç½® flutter ä½¿ç”¨é•œåƒç«™ç‚¹ "></a>3. é…ç½® flutter ä½¿ç”¨é•œåƒç«™ç‚¹ <a href="https://flutter.cn/docs/get-started/install/windows" target="_blank" rel="noopener"><fa-link/></a></h5><p>Flutter å®˜æ–¹ç«™ç‚¹ (<a href="https://flutter.dev" target="_blank" rel="noopener">https://flutter.dev</a>) æ˜¯åœ¨å¢ƒå¤–ï¼Œè¢«å°é•‡ç¦æ­¢è®¿é—®äº†ï¼Œæ‰€ä»¥ï¼Œæ­¤æ­¥éª¤æ˜¯å°é•‡ç”¨æˆ·éœ€è¦åšçš„é¢å¤–æ“ä½œã€‚</p>
<p>ç±»ä¼¼äºç¬¬äºŒæ­¥ï¼Œä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€æ­¥æ›´æ”¹çš„æ˜¯ <code>PUB_HOSTED_URL</code> å’Œ <code>FLUTTER_STORAGE_BASE_URL</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼ŒFlutter é•œåƒç«™ç‚¹ï¼Œé™¤äº† Flutter ä¸­æ–‡ç¤¾åŒº <code>flutter-io.cn</code> è¿™ä¸€ä¸ªï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªï¼Œå¦‚æœè§‰å¾—è¿™ä¸ªä¸»ç«™ç‚¹æ…¢ï¼Œå¯ä»¥éšæ—¶åˆ‡æ¢ï¼š</p>
<ul>
<li>ä¸Šæµ·äº¤é€šå¤§å­¦è½¯ä»¶æºé•œåƒæœåŠ¡</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export FLUTTER_STORAGE_BASE_URL: https://mirrors.sjtug.sjtu.edu.cn/</span><br><span class="line">export PUB_HOSTED_URL: https://dart-pub.mirrors.sjtug.sjtu.edu.cn/</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export FLUTTER_STORAGE_BASE_URL: https://mirrors.tuna.tsinghua.edu.cn/flutter</span><br><span class="line">export PUB_HOSTED_URL: https://mirrors.tuna.tsinghua.edu.cn/dart-pub</span><br></pre></td></tr></table></figure>

<h5 id="4-åˆå§‹åŒ–"><a href="#4-åˆå§‹åŒ–" class="headerlink" title="4. åˆå§‹åŒ– "></a>4. åˆå§‹åŒ– <a href="https://flutter.cn/docs/get-started/web" target="_blank" rel="noopener"><fa-link/></a></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter channel beta</span><br><span class="line">flutter upgrade</span><br><span class="line">flutter config --enable-web</span><br></pre></td></tr></table></figure>
<p><em>å¤‡æ³¨ï¼šåˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹è½½å¤±è´¥é—®é¢˜ï¼Œè¿™æ—¶å€™å¯ä»¥å‚ç…§ç¬¬ä¸‰æ­¥éª¤ï¼Œåˆ‡æ¢é•œåƒç«™ç‚¹ï¼Œå¹¶æ£€æŸ¥æ‚¨æ­¤æ—¶çš„ç½‘ç»œé“¾æ¥æ˜¯å¦å¯ä»¥è®¿é—®åˆ°é•œåƒç«™ç‚¹</em></p>
<h5 id="5-éªŒè¯å®‰è£…"><a href="#5-éªŒè¯å®‰è£…" class="headerlink" title="5. éªŒè¯å®‰è£… "></a>5. éªŒè¯å®‰è£… <a href="https://flutter.cn/docs/get-started/web" target="_blank" rel="noopener"><fa-link/></a></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter devices</span><br><span class="line">flutter doctor</span><br></pre></td></tr></table></figure>

<p><img src="/images/flutter/flutter%20doctor%20no%20issues%20found.jpg" alt="install successfully"></p>
<p>å¦‚æœ <code>flutter devices</code> ä¹¦å‡ºä¸€ä¸ªåä¸º Chrome çš„è®¾å¤‡ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºæ‰€æœ‰çš„å®‰è£…ã€é…ç½®å‡å®Œæˆã€‚</p>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello, World! "></a>Hello, World! <a href="https://flutter.cn/docs/get-started/web" target="_blank" rel="noopener"><fa-link/></a></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter create testflutter</span><br><span class="line">cd testflutter</span><br><span class="line">flutter run -d chrome --web-hostname=127.0.0.1</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—®ç«™ç‚¹</p>
<p><img src="/images/flutter/flutter%20run.png" alt="flutter run -d chrome --web-hostname=127.0.0.1"></p>
<h2 id="ç¼–è¯‘ã€éƒ¨ç½²"><a href="#ç¼–è¯‘ã€éƒ¨ç½²" class="headerlink" title="ç¼–è¯‘ã€éƒ¨ç½² "></a>ç¼–è¯‘ã€éƒ¨ç½² <a href="https://flutter.cn/docs/deployment/web" target="_blank" rel="noopener"><fa-link/></a></h2><p>ç¼–è¯‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter build web</span><br></pre></td></tr></table></figure>

<p>éƒ¨ç½²ï¼šéšä¾¿æ‰¾ä¸ªç«™ç‚¹æŒ‚æŒ‚ï¼Œæœ¬åœ°çš„ï¼Œæˆ–è€…äº‘ä¸Šçš„ã€‚</p>
<p><img src="/images/flutter/flutter%20build%20web.png" alt="flutter build web"></p>
<p>ğŸ‰ğŸ‰ğŸ‰ å®Œç¾ï¼Œç®—æ˜¯è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥äº†ï¼æ¥ä¸‹æ¥å°±æ˜¯æ‰¾ä¸ªç»ƒæ‰‹é¡¹ç›®ï¼Œç§¯æ”’ç»éªŒå€¼äº†ã€‚</p>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2020/07/18/get-started-with-Flutter/" data-id="clbs21iio001vo48cb7cshiuf" data-title="Flutter å…¥é—¨" class="article-share-link">åˆ†äº«</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flutter/" rel="tag">flutter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/get-started/" rel="tag">get started</a></li></ul>

</footer>
</div>

</article>




<nav id="page-nav">

<a class="extend prev" rel="prev" href="/page/19/">&lt; ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/21/">ä¸‹ä¸€é¡µ &gt;</a>
</nav>

<style>
.article {max-height: 123vh;overflow: hidden;position: relative;}
.article.unfold {max-height: initial;}
.article .more {position: absolute;bottom: 0;padding: 3em;cursor: pointer;text-align: center;width: 100%;background: linear-gradient(rgba(0, 0, 0, 0), silver);color: white;box-sizing: border-box;}
.article.unfold .more {display: none;}
</style>
<script>
(function () {
// show more
const moreText = '<i class="fa fa-arrow-circle-down" aria-hidden="true"></i> ' + "æ›´å¤š";
const articles = document.getElementsByClassName('article');
for (let i = 0; i < articles.length; i++) {
const $more = document.createElement('div');
$more.classList.add('more');$more.innerHTML = moreText;
$more.onclick = function (evt) {
const $src = evt.target || evt.srcElement;$src.parentElement.classList.add('unfold');
};
articles[i].appendChild($more);
}})();
</script>
</section>

</div>
<footer id="footer">

<div class="outer"><div id="footer-info" class="inner">&copy; 2022 æ—¶ä»£æ®‹å…š<br>
Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div>
</div></footer>
</div>
<nav id="mobile-nav">

<a href="/" class="mobile-nav-link">home</a>

<a href="/archives" class="mobile-nav-link">archives</a>

<a href="/app" class="mobile-nav-link">contact</a>

</nav>
<!--

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js" crossorigin="anonymous" integrity="sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU&#x3D; sha384-ECTndYny330R2jlSXBiZkdXzAVi0Z&#x2F;iDXJTwV6cp39HECmalqg6+b2sFZFf&#x2F;Y2m6 sha512-epzJ9ms+0Pq+zFMrG1lXVNvjEXgtfKx9iuEWqz3hmbaU2m&#x2F;Dp1pcmpYzuSdDLqX6PMIjzMOyGFwMc+SkgFhMFg&#x3D;&#x3D;"></script>

-->

<script src="/js/script.js" async></script>

</div>
<script>
(function () {
// append image-caption
const images = document.querySelectorAll('article img');
for (let j = 0; j < images.length; j++) {
const $img = images[j];
const altText = $img.getAttribute('alt');
if (altText && altText.length && !$img.classList.contains('inline')) {
const $imgCaption = document.createElement('div');
$imgCaption.classList.add('img-caption');
$imgCaption.innerText = $img.getAttribute('alt');
$img.parentNode.insertBefore($imgCaption, $img.nextSibling);
}}})();
</script>
</body></html>