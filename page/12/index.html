<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>时代残党</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" href="/favicon.png">
<meta property="og:type" content="website">
<meta property="og:title" content="时代残党">
<meta property="og:url" content="https://zxs66.github.io/page/12/">
<meta property="og:site_name" content="时代残党">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="时代残党">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="Angular">
<meta property="article:tag" content="NodeJS">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="ASP.NET">
<meta property="article:tag" content="Full Stack">
<meta name="twitter:card" content="summary">
<link rel="dns-prefetch" href="https://cdn.bootcdn.net/">
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://fonts.gstatic.com/">
<meta name="baidu-site-verification" content="1W34rVIdAO" />

<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous" integrity="sha256-eZrrJcwDc&#x2F;3uDhsdt61sL2oOBY362qM3lon1gyExkL0&#x3D; sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN sha512-SfTiTlX6kk+qitfevl&#x2F;7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+&#x2F;Sw&#x3D;&#x3D;">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" />


<link rel="stylesheet" href="/css/style.css">

<link rel="manifest" href="/manifest.json">
<script type="module" src="/pwabuilder-sw-register.js"></script>
<!-- 百度统计 -->
<script>
var _hmt = _hmt || [];
(function () {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?de1c4b02a9f8a51a6001797e045d3af9";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>
</head><body>
<div id="container">
<div id="wrap">
<header id="header">
<div id="banner"></div>
<div id="header-outer" class="outer">
<div id="header-title" class="inner">
<h1 id="logo-wrap">
<a href="/" id="logo">时代残党</a>
</h1>

<h2 id="subtitle-wrap">
<a href="/" id="subtitle">随手笔记</a>
</h2>

</div>
<div id="header-inner" class="inner">
<nav id="main-nav">
<a id="main-nav-toggle" class="nav-icon"></a>

<a class="main-nav-link" href="/">首页</a>

<a class="main-nav-link" href="/archives">归档</a>

<a class="main-nav-link" href="/app">联系我</a>

</nav>
<div id="search-form-wrap">
<div class="search-form"><input type="search" name="wd" class="search-form-input" placeholder="Search" list="search-datalist" autocomplete="false"/></div>

<input type="hidden" id="search-index-file" value="/search.json" />
<div id="search-form-datalist"></div>

</div>
<nav id="sub-nav">

<a id="nav-search-btn" class="nav-icon" title="搜索"></a>
</nav>
</div>
</div>
</header>
<div class="outer">
<section id="main">


<article id="post-CSharp-Regular-Experssion-taste" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2021/04/15/CSharp-Regular-Experssion-taste/" class="article-date">
  <time datetime="2021-04-15T10:05:56.000Z" itemprop="datePublished">2021-04-15</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/15/CSharp-Regular-Experssion-taste/">CSharp 正则表达式初尝</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>检测用户名和密码是否符合相应的强度要求：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> username = <span class="string">"BF-37"</span>;</span><br><span class="line"><span class="keyword">if</span> (!System.Text.RegularExpressions.Regex.Match(username, <span class="string">@"^[a-zA-Z0-9\-\.]&#123;4,16&#125;$"</span>).Success)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 大小写、数字、分隔符(-)、点号(.)，密码长度4到16</span></span><br><span class="line">  Console.WriteLine(<span class="string">"invalid user name"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">string</span> password = <span class="string">"Super hent@i"</span>;</span><br><span class="line"><span class="keyword">if</span> (!System.Text.RegularExpressions.Regex.Match(password, <span class="string">@"^[\s!-~]&#123;8,32&#125;$"</span>).Success)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 可打印字符（ASCII码从空格到~结束），密码长度8到32</span></span><br><span class="line">  Console.WriteLine(<span class="string">"invalid password"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2021/04/15/CSharp-Regular-Experssion-taste/" data-id="clab8ajsp000b6o8cfwz8agwb" data-title="CSharp 正则表达式初尝" class="article-share-link">分享</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csharp/" rel="tag">csharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regular-expression/" rel="tag">regular expression</a></li></ul>

</footer>
</div>

</article>



<article id="post-CORS-review" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2021/04/11/CORS-review/" class="article-date">
  <time datetime="2021-04-11T06:32:54.000Z" itemprop="datePublished">2021-04-11</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/11/CORS-review/">CORS 复习</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>好久没有更新了，主要是<del>工作忙</del>懒。正好前两天给同事开发 API 的时候，遇见一个小问题，这里简单记录一下。</p>
<p>故事是这样的，我明明给他开启了 CORS （已设置响应头，正确处理 preflight options request），但是对方从本地开发环境访问仍说 CORS 错误。因为这个 API 启用了 Windows 认证，我让他设置 <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials" target="_blank" rel="noopener">withCredentials:true</a>，也没有用，一直报错 401 或 405：</p>
<p><img src="/images/CORS-review/401_unauthorized.jpg" alt="401 Unauthorized"><br><img src="/images/CORS-review/405_method_not_allowed.jpg" alt="405 Method Not Allowed"></p>
<p>明明是复制粘贴之前能正常工作的代码，怎么就不行了？</p>
<p>好吧，按照 <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api" target="_blank" rel="noopener">官方推荐做法</a> 再来一遍：</p>
<ol>
<li>安装 NuGet 包： <code>Install-Package Microsoft.AspNet.WebApi.Cors</code></li>
<li>启用 CORS，在 <em>App_Start/WebApiConfig.cs</em> 文件新增如下代码：<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cors = <span class="keyword">new</span> System.Web.Http.Cors.EnableCorsAttribute</span><br><span class="line">  (</span><br><span class="line">      Constants.LocalDevEnv,</span><br><span class="line">      <span class="string">"*"</span>,</span><br><span class="line">      <span class="string">"*"</span></span><br><span class="line">  );</span><br><span class="line">cors.SupportsCredentials = <span class="literal">true</span>;</span><br><span class="line">config.EnableCors(cors);</span><br></pre></td></tr></table></figure></li>
<li>接收 preflight request，在<em>web.config</em>文件&lt;system.webServer&gt;&lt;handlers&gt;节点添加以下内容(一般安装 NuGet 包时自动添加)：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">handlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remove</span> <span class="attr">name</span>=<span class="string">"ExtensionlessUrlHandler-Integrated-4.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remove</span> <span class="attr">name</span>=<span class="string">"OPTIONSVerbHandler"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"ExtensionlessUrlHandler-Integrated-4.0"</span> <span class="attr">path</span>=<span class="string">"*."</span> <span class="attr">verb</span>=<span class="string">"*"</span> <span class="attr">type</span>=<span class="string">"System.Web.Handlers.TransferRequestHandler"</span> <span class="attr">preCondition</span>=<span class="string">"integratedMode,runtimeVersionv4.0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">handlers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>设置响应头，在 <em>web.config</em>文件&lt;system.webServer&gt;&lt;httpProtocol&gt;&lt;customHeaders&gt;节点添加以下内容：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Access-Control-Allow-Origin"</span> <span class="attr">value</span>=<span class="string">"http://localhost:3000"</span> /&gt;</span>  <span class="comment">&lt;!-- set the origin specifically--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Access-Control-Allow-Headers"</span> <span class="attr">value</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Access-Control-Allow-Methods"</span> <span class="attr">value</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Access-Control-Allow-Credentials"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>值得注意的是，因为我们启用了 Windows 认证，也就是说，跨域的时候需要设置正确的响应头，否则浏览器依然会报错：</p>
<blockquote>
<p>If the browser sends credentials, but the response does not include a valid Access-Control-Allow-Credentials header, the browser will not expose the response to the application, and the AJAX request fails. Be careful about setting SupportsCredentials to true, because it means a website at another domain can send a logged-in user’s credentials to your Web API on the user’s behalf, without the user being aware. The CORS spec also states that setting origins to “*” is invalid if SupportsCredentials is true.</p>
</blockquote>
<p>简单来说，当 API 需要发送 credentials 给 API 服务器时，<code>Access-Control-Allow-Origin</code> 不能为 <code>*</code>，必须得指明 Origin。</p>
<p>再次测试：</p>
<p><img src="/images/CORS-review/test.png" alt="测试结果"></p>
<p>Bingo！</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api" target="_blank" rel="noopener">Enable cross-origin requests in ASP.NET Web API 2</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/CORS" target="_blank" rel="noopener">CORS</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials" target="_blank" rel="noopener">Access-Control-Allow-Credentials</a></li>
</ul>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2021/04/11/CORS-review/" data-id="clab8ajsr000e6o8cg7k27y38" data-title="CORS 复习" class="article-share-link">分享</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cors/" rel="tag">cors</a></li></ul>

</footer>
</div>

</article>



<article id="post-MySQL-variables" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2021/03/25/MySQL-variables/" class="article-date">
  <time datetime="2021-03-25T14:42:51.000Z" itemprop="datePublished">2021-03-25</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/25/MySQL-variables/">MySQL 变量</a>
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>本文仅记录 MySQL 中本地变量和用户变量的相同和不同。</p>
<h3 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR;"></a>TL;DR;</h3><p>感觉英文还行的看官，请直接移步 <a href="#参考链接">参考链接</a> 查看 MySQL 官方文档。</p>
<h5 id="相同点："><a href="#相同点：" class="headerlink" title="相同点："></a>相同点：</h5><p>都可以使用 SET 语句赋值。</p>
<h5 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h5><table>
<thead>
<tr>
<th></th>
<th>本地变量</th>
<th>用户变量</th>
</tr>
</thead>
<tbody><tr>
<td>变量名称格式</td>
<td>不以@开头</td>
<td>必须以@开头</td>
</tr>
<tr>
<td>是否需要DECLARE</td>
<td>✔️</td>
<td>❌</td>
</tr>
<tr>
<td>常见使用场景</td>
<td>存储过程</td>
<td>即时查询窗口</td>
</tr>
<tr>
<td>存在作用域</td>
<td>当前存储过程</td>
<td>当前会话</td>
</tr>
</tbody></table>
<blockquote>
<p>The scope of a local variable is the BEGIN … END block within which it is declared. The variable can be referred to in blocks nested within the declaring block, except those blocks that declare a variable with the same name. Because local variables are in scope only during stored program execution, references to them are not permitted in prepared statements created within a stored program. Prepared statement scope is the current session, not the stored program, so the statement could be executed after the program ends, at which point the variables would no longer be in scope. For example, SELECT … INTO local_var cannot be used as a prepared statement. </p>
</blockquote>
<blockquote>
<p>User-defined variables are session specific. A user variable defined by one client cannot be seen or used by other clients. (Exception: A user with access to the Performance Schema user_variables_by_thread table can see all user variables for all sessions.) All variables for a given client session are automatically freed when that client exits.</p>
</blockquote>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/user-variables.html" target="_blank" rel="noopener">MySQL::User-Defined Variables</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/local-variable-scope.html" target="_blank" rel="noopener">MySQL::Local Variable Scope and Resolution</a></li>
<li><a href="https://www.delftstack.com/howto/mysql/mysql-declare-variable/" target="_blank" rel="noopener">Declare and Use Variables in MySQL</a></li>
</ul>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2021/03/25/MySQL-variables/" data-id="clab8ajsy000y6o8c5e8r85gx" data-title="MySQL 变量" class="article-share-link">分享</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/variable/" rel="tag">variable</a></li></ul>

</footer>
</div>

</article>




<nav id="page-nav">

<a class="extend prev" rel="prev" href="/page/11/">&lt; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/13/">下一页 &gt;</a>
</nav>

<style>
.article {max-height: 123vh;overflow: hidden;position: relative;}
.article.unfold {max-height: initial;}
.article .more {position: absolute;bottom: 0;padding: 3em;cursor: pointer;text-align: center;width: 100%;background: linear-gradient(rgba(0, 0, 0, 0), silver);color: white;box-sizing: border-box;}
.article.unfold .more {display: none;}
</style>
<script>
(function () {
// show more
const moreText = '<i class="fa fa-arrow-circle-down" aria-hidden="true"></i> ' + "更多";
const articles = document.getElementsByClassName('article');
for (let i = 0; i < articles.length; i++) {
const $more = document.createElement('div');
$more.classList.add('more');$more.innerHTML = moreText;
$more.onclick = function (evt) {
const $src = evt.target || evt.srcElement;$src.parentElement.classList.add('unfold');
};
articles[i].appendChild($more);
}})();
</script>
</section>

</div>
<footer id="footer">

<div class="outer"><div id="footer-info" class="inner">&copy; 2022 时代残党<br>
Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div>
</div></footer>
</div>
<nav id="mobile-nav">

<a href="/" class="mobile-nav-link">home</a>

<a href="/archives" class="mobile-nav-link">archives</a>

<a href="/app" class="mobile-nav-link">contact</a>

</nav>
<!--

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js" crossorigin="anonymous" integrity="sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU&#x3D; sha384-ECTndYny330R2jlSXBiZkdXzAVi0Z&#x2F;iDXJTwV6cp39HECmalqg6+b2sFZFf&#x2F;Y2m6 sha512-epzJ9ms+0Pq+zFMrG1lXVNvjEXgtfKx9iuEWqz3hmbaU2m&#x2F;Dp1pcmpYzuSdDLqX6PMIjzMOyGFwMc+SkgFhMFg&#x3D;&#x3D;"></script>

-->

<script src="/js/script.js" async></script>

</div>
<script>
(function () {
// append image-caption
const images = document.querySelectorAll('article img');
for (let j = 0; j < images.length; j++) {
const $img = images[j];
const altText = $img.getAttribute('alt');
if (altText && altText.length && !$img.classList.contains('inline')) {
const $imgCaption = document.createElement('div');
$imgCaption.classList.add('img-caption');
$imgCaption.innerText = $img.getAttribute('alt');
$img.parentNode.insertBefore($imgCaption, $img.nextSibling);
}}})();
</script>
</body></html>