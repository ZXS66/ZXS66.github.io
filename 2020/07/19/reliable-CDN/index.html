<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>可靠 CDN | 时代残党</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" href="/favicon.png">
<meta name="description" content="前几天，把博客的 font-awesome 引用从博客站点本身切换到 CDN。图省事，就用了以前国内外通用的 cloudflare，因为之前不管是在公司（外网），还是在家里（国内），访问都挺快的。然后，就出事了。。。 今天在家，闲来没事，打开自己的博客，发现 font-awesome 加载不了。起初，我以为是浏览器问题，因为我用 Firefox 有时候能正常渲染 icon font，过一会儿刷新一">
<meta property="og:type" content="article">
<meta property="og:title" content="可靠 CDN">
<meta property="og:url" content="https://zxs66.github.io/2020/07/19/reliable-CDN/">
<meta property="og:site_name" content="时代残党">
<meta property="og:description" content="前几天，把博客的 font-awesome 引用从博客站点本身切换到 CDN。图省事，就用了以前国内外通用的 cloudflare，因为之前不管是在公司（外网），还是在家里（国内），访问都挺快的。然后，就出事了。。。 今天在家，闲来没事，打开自己的博客，发现 font-awesome 加载不了。起初，我以为是浏览器问题，因为我用 Firefox 有时候能正常渲染 icon font，过一会儿刷新一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/caniuse%20font%20face%20web%20fonts.jpg">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/firefox%20cert%20invalid.jpg">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/firefox%20working.jpg">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/firefox%20cert%20invalid%204.jpg">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/questions.png">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/firefox%20cert%20invalid%202.jpg">
<meta property="og:image" content="https://zxs66.github.io/images/reliable-cdn/firefox%20cert%20invalid%203.jpg">
<meta property="article:published_time" content="2020-07-19T07:40:45.000Z">
<meta property="article:modified_time" content="2022-11-08T14:11:27.203Z">
<meta property="article:author" content="时代残党">
<meta property="article:tag" content="cdn">
<meta property="article:tag" content="cloudflare">
<meta property="article:tag" content="baidu">
<meta property="article:tag" content="firefox">
<meta property="article:tag" content="iconfont">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zxs66.github.io/images/reliable-cdn/caniuse%20font%20face%20web%20fonts.jpg">
<link rel="dns-prefetch" href="https://cdn.bootcdn.net/">
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://fonts.gstatic.com/">
<meta name="baidu-site-verification" content="1W34rVIdAO" />

<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous" integrity="sha256-eZrrJcwDc&#x2F;3uDhsdt61sL2oOBY362qM3lon1gyExkL0&#x3D; sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN sha512-SfTiTlX6kk+qitfevl&#x2F;7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+&#x2F;Sw&#x3D;&#x3D;">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" />


<link rel="stylesheet" href="/css/style.css">

<link rel="manifest" href="/manifest.json">
<script type="module" src="/pwabuilder-sw-register.js"></script>
<!-- 百度统计 -->
<script>
var _hmt = _hmt || [];
(function () {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?de1c4b02a9f8a51a6001797e045d3af9";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>
</head><body>
<div id="container">
<div id="wrap">
<header id="header">
<div id="banner"></div>
<div id="header-outer" class="outer">
<div id="header-title" class="inner">
<h1 id="logo-wrap">
<a href="/" id="logo">时代残党</a>
</h1>

<h2 id="subtitle-wrap">
<a href="/" id="subtitle">随手笔记</a>
</h2>

</div>
<div id="header-inner" class="inner">
<nav id="main-nav">
<a id="main-nav-toggle" class="nav-icon"></a>

<a class="main-nav-link" href="/">首页</a>

<a class="main-nav-link" href="/archives">归档</a>

<a class="main-nav-link" href="/app">联系我</a>

</nav>
<div id="search-form-wrap">
<div class="search-form"><input type="search" name="wd" class="search-form-input" placeholder="Search" list="search-datalist" autocomplete="false"/></div>

<input type="hidden" id="search-index-file" value="/search.json" />
<div id="search-form-datalist"></div>

</div>
<nav id="sub-nav">

<a id="nav-search-btn" class="nav-icon" title="搜索"></a>
</nav>
</div>
</div>
</header>
<div class="outer">
<section id="main">
<article id="post-reliable-CDN" class="article article-type-post" itemscope itemprop="blogPost">
<div class="article-meta">
<a href="/2020/07/19/reliable-CDN/" class="article-date">
  <time datetime="2020-07-19T07:40:45.000Z" itemprop="datePublished">2020-07-19</time>
</a>

</div>
<div class="article-inner">


<header class="article-header">
  
    <h1 class="article-title" itemprop="name">
      可靠 CDN
    </h1>
  
</header>

<div class="article-entry" itemprop="articleBody">
<p>前几天，把博客的 <a href="https://fontawesome.com/" target="_blank" rel="noopener">font-awesome</a> 引用从博客站点本身切换到 CDN。图省事，就用了以前国内外通用的 <a href="https://www.cloudflare.com/zh-cn/network/china/" target="_blank" rel="noopener">cloudflare</a>，因为之前不管是在公司（外网），还是在家里（国内），访问都挺快的。然后，就出事了。。。</p>
<p>今天在家，闲来没事，打开自己的博客，发现 font-awesome 加载不了。起初，我以为是浏览器问题，因为我用 Firefox 有时候能正常渲染 icon font，过一会儿刷新一下又不能了，但是我用 Chrome 一直都可以正常工作。</p>
<p>去网上搜索一圈，发现 MDN 说：</p>
<blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener"><i class="fa fa-link" aria-hidden="true"></i></a> Web Fonts (for cross-domain font usage in @font-face within CSS), so that servers can deploy TrueType fonts that can only be cross-site loaded and used by web sites that are permitted to do so. </p>
</blockquote>
<blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener"><i class="fa fa-link" aria-hidden="true"></i></a> Fonts applied with @font-face. Some browsers allow cross-origin fonts, others require same-origin. </p>
</blockquote>
<p>发生跨域了？废话，用 CDN 肯定要跨域啊。但这些应该都是正常操作，Chrome 都行。emmm，Firefox 你在作妖吗。MDN 说的 others，该不会说的就是它自己吧。。。</p>
<p>查证一下 <a href="https://caniuse.com/#feat=fontface" target="_blank" rel="noopener">Can I use</a>：</p>
<p><img src="/images/reliable-cdn/caniuse%20font%20face%20web%20fonts.jpg" alt=""></p>
<p>只要服务器支持 CORS 浏览器就没问题！<a href="http://cssbakery.com/2010/07/fixing-firefox-font-face-cross-domain_25.html" target="_blank" rel="noopener">这篇文章</a> 遇到的问题也是这样。</p>
<p>不会吧，CDN 不支持 CORS 那 CDN 要怎么用，cloudflare 肯定是支持 CORS 的！</p>
<p>再回头对比一下，我发现是 Firefox 请求字体文件出错时，发送的请求，是不带 HTTP 版本号的。</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid.jpg" alt="firefox 请求字体文件不带版本号"></p>
<p>而正常请求是指定了 HTTP 版本号的：</p>
<p><img src="/images/reliable-cdn/firefox%20working.jpg" alt="firefox 正常请求字体"></p>
<p>但是偶然又有一次带了版本号依然无法请求资源</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid%204.jpg" alt="firefox 请求字体文件不带版本号"></p>
<p>什么鬼，你耍我？ <img src="/images/reliable-cdn/questions.png" alt="？？？"> </p>
<p>莫非，真的是 CDN 问题？我查查…</p>
<p>好家伙，还真有问题！<a href="https://segmentfault.com/a/1190000023290310" target="_blank" rel="noopener">Cloudflare DNS 服务中断，大量网站和服务无法访问</a> </p>
<p>虽然文中并未提及国内是否受波及，但为什么我受影响了？我去 <a href="https://www.cloudflarestatus.com/" target="_blank" rel="noopener">官网</a> 看看。官网说了</p>
<blockquote>
<p>All Systems Operational</p>
</blockquote>
<p>所有节点均正常？你确定？然后，我发现，7月17号，也就是前天有一个 incident</p>
<blockquote>
<h2 id="Cloudflare-Network-and-Resolver-Issues"><a href="#Cloudflare-Network-and-Resolver-Issues" class="headerlink" title="Cloudflare Network and Resolver Issues"></a>Cloudflare Network and Resolver Issues</h2><p>Resolved - This incident has been resolved.<br>Jul 17, 22:57 UTC<br>Monitoring - A fix has been implemented and we are monitoring the results.<br>Jul 17, 22:34 UTC<br>Update - This afternoon we saw an outage across some parts of our network. It was not as a result of an attack. It appears a router on our global backbone announced bad routes and caused some portions of the network to not be available. We believe we have addressed the root cause and are monitoring systems for stability now.<br>Jul 17, 22:09 UTC</p>
</blockquote>
<p>嘶<del>~</del> 有点不靠谱的感觉。没人攻击您，后台路由出问题了？</p>
<p>稍等，我之前好像看见，cloudflare 国内是和百度云合作的？嘶<del>~</del> （不吹不黑，只是个人不喜欢太商业化的东西）</p>
<p>拜拜咯，cloudflare！下载一个 js 和 css 文件都这么慢，还不如直接使用自己站点资源 🤦‍</p>
<p><img src="/images/reliable-cdn/firefox%20cert%20invalid%202.jpg" alt="firefox 请求 css 文件"><br><img src="/images/reliable-cdn/firefox%20cert%20invalid%203.jpg" alt="firefox 请求 js 文件"></p>
<p>既然不用 cloudflare，那换谁呢？简单搜索了一下，目前看起来，bootcdn 还不错，行，安排！！</p>
<p>刷刷刷，搞定！</p>
<p>firefox 打开，正常！</p>

</div>
<footer class="article-footer">
<a data-url="https://zxs66.github.io/2020/07/19/reliable-CDN/" data-id="clbrssbbz003ie28ce6x4d96b" data-title="可靠 CDN" class="article-share-link">分享</a>


  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/baidu/" rel="tag">baidu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cdn/" rel="tag">cdn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cloudflare/" rel="tag">cloudflare</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iconfont/" rel="tag">iconfont</a></li></ul>

</footer>
</div>

<nav id="article-nav">
  
    <a href="/2020/07/23/CDN-failover/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">更新</strong>
      <div class="article-nav-title">
        
          CDN 故障转移
        
      </div>
    </a>
  
  
    <a href="/2020/07/18/get-started-with-Flutter/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">更早</strong>
      <div class="article-nav-title">Flutter 入门</div>
    </a>
  
</nav>

</article>


</section>

</div>
<footer id="footer">

<div class="outer"><div id="footer-info" class="inner">&copy; 2022 时代残党<br>
Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div>
</div></footer>
</div>
<nav id="mobile-nav">

<a href="/" class="mobile-nav-link">home</a>

<a href="/archives" class="mobile-nav-link">archives</a>

<a href="/app" class="mobile-nav-link">contact</a>

</nav>
<!--

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js" crossorigin="anonymous" integrity="sha256-pXtSQrmprcTB74RsNlFHuJxHK5zXcPrOMx78uWU0ayU&#x3D; sha384-ECTndYny330R2jlSXBiZkdXzAVi0Z&#x2F;iDXJTwV6cp39HECmalqg6+b2sFZFf&#x2F;Y2m6 sha512-epzJ9ms+0Pq+zFMrG1lXVNvjEXgtfKx9iuEWqz3hmbaU2m&#x2F;Dp1pcmpYzuSdDLqX6PMIjzMOyGFwMc+SkgFhMFg&#x3D;&#x3D;"></script>

-->

<script src="/js/script.js" async></script>

</div>
<script>
(function () {
// append image-caption
const images = document.querySelectorAll('article img');
for (let j = 0; j < images.length; j++) {
const $img = images[j];
const altText = $img.getAttribute('alt');
if (altText && altText.length && !$img.classList.contains('inline')) {
const $imgCaption = document.createElement('div');
$imgCaption.classList.add('img-caption');
$imgCaption.innerText = $img.getAttribute('alt');
$img.parentNode.insertBefore($imgCaption, $img.nextSibling);
}}})();
</script>
</body></html>